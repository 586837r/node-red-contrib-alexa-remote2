<script type="text/x-red" data-template-name="alexa-remote-init">
	<div class="form-row">
		<label for="node-input-name"><i class="icon-tag"></i> Name</label>
		<input type="text" id="node-input-name" placeholder="Optional">
	</div>
	<div class="form-row">
		<label for="node-input-account"><i class="fa fa-amazon"></i> Account</label>
		<input id="node-input-account">
	</div>
	<div class="form-row">
        <label for="node-input-autoInit"><i class="fa fa-wrench"></i> Auto Init</label>
		<select id="node-input-autoInit" style="width: 70%;">
			<option value="on">On</option>
			<option value="off">Off</option>
		</select>
	</div>
</script>

<script type="text/x-red" data-help-name="alexa-remote-init">
	<p>Initializes an alexa instance connected to an account.</p>
	<p>
		This is only necessary when the <code>manual</code> initialization behaviour is chosen
		for the account. In all cases it can be used to check if initialization alone is successful.
	</p>

	<h3>Outputs</h3>
    <ol class="node-ports">
		<dl class="message-properties">
			<dt>payload <span class="property-type">Object</span></dt>
			<dd>the standard output, is undefined on success</dd>
		</dl>
		<dl class="message-properties">
			<dt>error <span class="property-type">Object</span></dt>
			<dd>the standard error output, is undefined on success</dd>
		</dl>
	</ol>
	
	<h3>References</h3>
    <ul>
		<li><a href="https://npmjs.com/package/node-red-contrib-alexa-remote2">npm</a> - the nodes npm repository</li>
        <li><a href="https://github.com/586837r/node-red-contrib-alexa-remote2">GitHub</a> - the nodes github repository</li>
    </ul>
</script>

<script type="text/javascript">
	RED.nodes.registerType('alexa-remote-init', {
		category: 'alexa',
		color: '#6fbad8',
		defaults: {
			name: { value: '' },
			account: { value: '', type: 'alexa-remote-account', required: true },
			autoInit: { value: 'on' }
		},
		inputs: 1,
		outputs: 1,
		icon: 'alexa-remote-icon.png',
		paletteLabel: 'Alexa Init',
		label: function () {
			return this.name || "Alexa Init";
		},
		labelStyle: function () {
			return this.name ? "node_label_italic" : "";
		},
		button: {
            enabled: function() {
                return !this.changed
            },
            onclick: function() {
                if (this.changed) {
                    return RED.notify(RED._("notification.warning", {message:RED._("notification.warnings.undeployedChanges")}),"warning");
				}
                $.ajax({
                    url: "alexa-remote-init/"+this.id,
                    type:"POST",
                    success: function(resp) {
                        RED.notify("Alexa Init Requested","success");
                    },
					error: function(jqXHR,textStatus,errorThrown) {
                        if (jqXHR.status == 404) {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.not-deployed")}),"error");
                        } else if (jqXHR.status == 500) {
                            RED.notify(node._("common.notification.error",{message:node._("inject.errors.failed")}),"error");
                        } else if (jqXHR.status == 0) {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.no-response")}),"error");
                        } else {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.unexpected",{status:jqXHR.status,message:textStatus})}),"error");
                        }
                    }
                }); 
            }
        }
	});
</script>