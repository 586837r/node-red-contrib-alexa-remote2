<script type="text/x-red" data-template-name="alexa-remote-account">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Optional">
	</div>
	<hr>
	<div class="form-row">
        <label for=""> Auth Method</label>
        <select id="node-config-input-authMethod" style="width: 70%;">
            <option value="proxy">Proxy</option>
            <option value="cookie">Cookie</option>
            <option value="password">Email & Password (deprecated)</option>
		</select>
    </div>
    <div class="form-row">
        <label for="node-config-input-cookie"><i class="fa fa-coffee"></i> Cookie</label>
        <input type="text" id="node-config-input-cookie" placeholder="Required">
    </div>
    <div class="form-row">
        <label for="node-config-input-email"><i class="fa fa-user"></i> Email</label>
        <input type="text" id="node-config-input-email" placeholder="Required">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-config-input-password" placeholder="Required">
	</div>
	<div class="form-row">
        <label for="node-config-input-proxyPort"><i class="fa fa-ship"></i> Port</label>
        <input type="number" id="node-config-input-proxyPort" placeholder="Required">
	</div>
	<div class="form-row">
        <label for="node-config-input-cookieFile"><i class="fa fa-file"></i> File Path</label>
        <input type="text" id="node-config-input-cookieFile" placeholder="Optional">
	</div>
	<hr>
    <div class="form-row">
        <label for="node-config-input-alexaServiceHost"><i class="fa fa-amazon"></i> Service Host</label>
        <input type="text" id="node-config-input-alexaServiceHost" placeholder="Required">
    </div>
    <div class="form-row">
        <label for="node-config-input-amazonPage"><i class="fa fa-amazon"></i> Page</label>
        <input type="text" id="node-config-input-amazonPage" placeholder="Required">
    </div>
	<div class="form-row">
		<label for="node-config-input-acceptLanguage"><i class="fa fa-language"></i> Language</label>
		<input type="text" id="node-config-input-acceptLanguage" placeholder="Optional">
	</div>
    <div class="form-row">
        <label for="node-config-input-userAgent"><i class="fa fa-info-circle"></i> User Agent</label>
        <input type="text" id="node-config-input-userAgent" placeholder="Optional">
    </div>
	<hr>
    <div class="form-row">
        <label for="node-config-input-useWsMqtt"><i class="fa fa-rocket"></i> Events</label>
		<select id="node-config-input-useWsMqtt" style="width: 70%;">
			<option value="on">On</option>
			<option value="off">Off</option>
		</select>
	</div>
	<div class="form-row">
        <label for="node-config-input-bluetooth"><i class="fa fa-bluetooth"></i> Bluetooth</label>
		<select id="node-config-input-bluetooth" style="width: 70%;">
			<option value="on">On</option>
			<option value="off">Off</option>
		</select>
	</div>

</script>

<script type="text/x-red" data-help-name="alexa-remote-account">
	<p>Account configuration node.</p>

	<h3>Credentials</h3>
	<p>You can either enter your <b>Cookie</b> or your <b>Email</b> and <b>Password</b>
		to access your Account.</p>

	<h3>Request Details</h3>
	<p>The <code>Service Host</code> and <code>Page</code> will depend on your location. For example:</p>
		<ul>
			<li>USA: <code>pitangui.amazon.com</code> and <code>amazon.com</code></li>
			<li>UK: <code>alexa.amazon.co.uk</code> and <code>amazon.co.uk</code></li>
			<li>Germany: <code>layla.amazon.de</code> and <code>amazon.de</code></li>
		</ul>
		<p>You can optionally define the request Accept-<b>Language</b> Header and the <b>User Agent</b>.
		   Language may look like <code>en-US</code>, <code>en-UK</code> or <code>de-DE</code> etc.
		</p>
	</p>
	<h3>Behaviour Settings</h3>
	<p><b>Events</b> needs to be <code>on</code> to use the Alexa Remote Event node with this account.</p>
	<p><b>Bluetooth</b> needs to be <code>on</code> to use some bluetooth related commands.</p>
	<p><b>Init Behaviour: </b>Each Alexa Remote Account has an <code>AlexaRemote</code> instance that does all the work. It needs to be initialized before
	using it, to generate the cookie and request the devices to resolve device names and more.</p>
	<ul>
		<li><b>Lazy</b><i>(default)</i> means that AlexaRemote is initialized if it hasn't yet been initialized or if an error occured.</li>
		<li><b>Manual</b> means that only the Alexa Init node will initialize AlexaRemote.</li>
		<li><b>Every Request</b> means that AlexaRemote is (re)initialized before every request</li>
	</ul>

	<h3>References</h3>
    <ul>
		<li><a href="https://npmjs.com/package/node-red-contrib-alexa-remote2">npm</a> - the nodes npm repository</li>
        <li><a href="https://github.com/586837r/node-red-contrib-alexa-remote2">GitHub</a> - the nodes github repository</li>
    </ul>
</script>

<script type="text/javascript">
    RED.nodes.registerType('alexa-remote-account', {
        category: 'config',
        credentials: {
            cookie: 	{ type: 'text' },
            email: 		{ type: 'text' },
            password: 	{ type: 'password' },
        },
        defaults: {
			name:               { required: false, value: '' },
			authMethod: 		{ required: true,  value: 'proxy' },
			proxyPort:			{ required: true,  value: 3456, validate: x => 0 <= Number(x) && Number(x) <= 65535 },
			cookieFile:			{ required: false, value: ''},
            alexaServiceHost:   { required: true,  value: 'pitangui.amazon.com' },
            userAgent:          { required: false, value: '' },
            acceptLanguage:     { required: true,  value: 'en-US' },
			amazonPage:         { required: true,  value: 'amazon.com' },
			useWsMqtt:			{ required: true,  value: 'on' },
			bluetooth: 			{ required: true,  value: 'off' },
			autoInit:			{ required: true,  value: 'on' }
		},
		paletteLabel: 'Alexa Account',
        label: function () {
            return this.name || 'Alexa Account';
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : '';
		}, 
		oneditprepare: function () {
			const getInput = x => $(`#node-config-input-${x}`);
			const getRow = x => getInput(x).parent();
			
			let rowmap = {
				proxy: [ getRow('proxyPort'), getRow('cookieFile') ],
				cookie: [ getRow('cookie') ],
				password: [ getRow('email'), getRow('password') ]
			}

			getInput('authMethod').change(event => {
				Object.entries(rowmap).forEach(([k,v]) => {
					k === event.target.value ? v.forEach(r => r.show()) : v.forEach(r => r.hide());
				});
			});
		}
	});
</script>